Before:
  messages clear
  normal! gg

~ 1 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Regular URL):
  [ridiculus][0] mus.

  ## Links

  [0]: https://www.vim.org/
~~~~~~~~~~~~~~~~~~~~~~~~~

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://www.vim.org/'
  AssertEqual exp, message

~ 2 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (URL containing percent-encoding):
  [ridiculus][0] mus.

  ## Links

  [0]: https://en.wikipedia.org/wiki/Giro_d%27Italia
~~~~~~~~~~~~~~~~~~~~~~~~~

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://en.wikipedia.org/wiki/Giro_d%27Italia'
  AssertEqual exp, message

~ 3 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (URL containing percent-encoding and hash sign):
  [ridiculus][0] mus.

  ## Links

  [0]: https://en.wikipedia.org/wiki/Giro_d%27Italia#Defunct_classifications
~~~~~~~~~~~~~~~~~~~~~~~~~

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://en.wikipedia.org/wiki/Giro_d%27Italia#Defunct_classifications'
  AssertEqual exp, message

~ 4 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (URL containing question mark):
  [ridiculus][0] mus.

  ## Links

  [0]: https://www.mobileread.com/forums/showthread.php?p=1769412
~~~~~~~~~~~~~~~~~~~~~~~~~

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://www.mobileread.com/forums/showthread.php?p=1769412'
  AssertEqual exp, message

~ 5 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (URL containing question mark and ampersand):
  [ridiculus][0] mus.

  ## Links

  [0]: https://www.mobileread.com/forums/showpost.php?p=1769412&postcount=1
~~~~~~~~~~~~~~~~~~~~~~~~~

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://www.mobileread.com/forums/showpost.php?p=1769412&postcount=1'
  AssertEqual exp, message

~ 6 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (From reference section):
  # A consectetuer nunc justo ac nisl.
  
  ## Nam vitae purus
  
  Cum sociis natoque penatibus et magnis dis parturient montes,
  nascetur ridiculus mus.
  
  ## Links
  
  [0]: http://www.loremipsumdolorsitamet.com
~~~~~~~~~~~~~~~~~~~~~~~~~
Execute:
  call cursor('$', 1)
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'http://www.loremipsumdolorsitamet.com'
  AssertEqual exp, message

~ 7 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Line without link):
  Praesent semper magna. In eu justo. Nunc vitae risus nec
  sem scelerisque consequat. In hac habitasse platea dictumst. Nam posuere
~~~~~~~~~~~~~~~~~~~~~~~~~
Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'link.vim: No link found under cursor'
  AssertEqual exp, message

~ 8 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Invalid URL: no protocol):
  [natoque][0] penatibus et magnis dis parturient montes,
  nascetur ridiculus mus.
  
  ## Links
  
  [0]: loremipsum.com
~~~~~~~~~~~~~~~~~~~~~~~~~
Execute:
  let out = execute('LinkOpen')
  let messages = split(out, "\n")
  let exp = []
  AssertEqual exp, messages

~ 9 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal link to existing Markdown file):
  [ridiculus][0] mus.

  [0]: bar.md
--------------------------------------------------------------------------------

Execute:
  silent !touch bar.md
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'bar.md', filename
  silent !rm bar.md

~ 10 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal link to non-existent Markdown file):
  [ridiculus][0] mus.

  [0]: foo.md
--------------------------------------------------------------------------------

Execute:
  LinkOpen
  let filename = expand('%:t')
  AssertEqual '[Vader-workbench]', filename

~ 11 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (External Wiki link with description):
  [[https://www.vim.org|Vim's website]] et magnis dis parturient montes,
  nascetur ridiculus mus.
--------------------------------------------------------------------------------

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://www.vim.org'
  AssertEqual exp, message

~ 12 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (External Wiki link without description):
  [[https://www.vim.org]] et magnis dis parturient montes,
  nascetur ridiculus mus.
--------------------------------------------------------------------------------

Execute:
  let out = execute('LinkOpen')
  let message = split(out, "\n")[0]
  let exp = 'https://www.vim.org'
  AssertEqual exp, message

~ 13 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal Wiki link with description, without extension to existing file):
  [[bar|My recipes]] mus.

--------------------------------------------------------------------------------

Execute:
  silent !touch bar.md
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'bar.md', filename
  silent !rm bar.md

~ 14 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal Wiki link with description, with extension to existing file):
  [[bar.md|My recipes]] mus.

--------------------------------------------------------------------------------

Execute:
  silent !touch bar.md
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'bar.md', filename
  silent !rm bar.md

~ 15 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal Wiki link with description, without extension to non-existent file):
  [[alpha|My recipes]] mus.

--------------------------------------------------------------------------------

Execute:
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'alpha.md', filename

~ 16 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal Wiki link without description, without extension to non-existent file):
  [[bravo]] mus.

--------------------------------------------------------------------------------

Execute:
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'bravo.md', filename

~ 17 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Given markdown (Internal Wiki link without description, with extension to non-existent file):
  [[charlie.md]] mus.

--------------------------------------------------------------------------------

Execute:
  LinkOpen
  let filename = expand('%:t')
  AssertEqual 'charlie.md', filename

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
